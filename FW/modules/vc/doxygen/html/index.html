<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>VideoCore Library: OS Abstraction Layer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">VideoCore Library
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">OS Abstraction Layer </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="intro"></a>
Introduction</h1>
<p>This abstraction layer is here to allow the underlying OS to be easily changed (e.g. from Nucleus to ThreadX) and to aid in porting host applications to new targets.</p>
<h2><a class="anchor" id="error"></a>
Error handling</h2>
<p>Wherever possible, VCOS functions assert internally and return void. The only exceptions are creation functions (which might fail due to lack of resources) and functions that might timeout or fail due to lack of space. Errors that might be reported by the underlying OS API (e.g. invalid mutex) are treated as a programming error, and are merely asserted on.</p>
<h1><a class="anchor" id="thread_synch"></a>
Threads and synchronisation</h1>
<h2><a class="anchor" id="thread"></a>
Threads</h2>
<p>The thread API is somewhat different to that found in Nucleus. In particular, threads cannot just be destroyed at arbitrary times and nor can they merely exit. This is so that the same API can be implemented across all interesting platforms without too much difficulty. See <a class="el" href="de/d30/vcos__thread_8h.html">vcos_thread.h</a> for details. Thread attributes are configured via the <a class="el" href="df/df9/structVCOS__THREAD__ATTR__T.html">VCOS_THREAD_ATTR_T</a> structure, found in <a class="el" href="d1/d6d/vcos__thread__attr_8h.html">vcos_thread_attr.h</a>.</p>
<h2><a class="anchor" id="sema"></a>
Semaphores</h2>
<p>Counted semaphores (c.f. Nucleus NU_SEMAPHORE) are created with VCOS_SEMAPHORE_T. Under ThreadX on VideoCore, semaphores are implemented using VideoCore spinlocks, and so are quite a lot faster than ordinary ThreadX semaphores. See <a class="el" href="d2/dc2/vcos__semaphore_8h.html">vcos_semaphore.h</a>.</p>
<h2><a class="anchor" id="mtx"></a>
Mutexes</h2>
<p>Mutexes are used for locking. Attempts to take a mutex twice, or to unlock it in a different thread to the one in which it was locked should be expected to fail. Mutexes are not re-entrant (see <a class="el" href="d6/da9/vcos__reentrant__mutex_8h.html">vcos_reentrant_mutex.h</a> for a slightly slower re-entrant mutex).</p>
<h2><a class="anchor" id="evflags"></a>
Event flags</h2>
<p>Event flags (the ThreadX name - also known as event groups under Nucleus) provide 32 flags which can be waited on by multiple clients, and signalled by multiple clients. A timeout can be specified. See <a class="el" href="d8/d7a/vcos__event__flags_8h.html">vcos_event_flags.h</a>. An alternative to this is the <a class="el" href="db/d7b/structVCOS__EVENT__T.html">VCOS_EVENT_T</a> (see <a class="el" href="dc/dd7/vcos__event_8h.html">vcos_event.h</a>) which is akin to the Win32 auto-reset event, or a saturating counted semaphore.</p>
<h2><a class="anchor" id="event"></a>
Events</h2>
<p>A <a class="el" href="db/d7b/structVCOS__EVENT__T.html">VCOS_EVENT_T</a> is a bit like a saturating semaphore. No matter how many times it is signalled, the waiter will only wake up once. See <a class="el" href="dc/dd7/vcos__event_8h.html">vcos_event.h</a>. You might think this is useful if you suspect that the cost of reading the semaphore count (perhaps via a system call) is expensive on your platform.</p>
<h2><a class="anchor" id="tls"></a>
Thread local storage</h2>
<p>Thread local storage is supported using <a class="el" href="dc/d07/vcos__tls_8h.html">vcos_tls.h</a>. This is emulated on Nucleus and ThreadX.</p>
<h1><a class="anchor" id="int"></a>
Interrupts</h1>
<p>The legacy LISR/HISR scheme found in Nucleus is supported via the legacy ISR API, which is also supported on ThreadX. New code should avoid this, and old code should be migrated away from it, since it is slow. See <a class="el" href="d9/d0e/vcos__legacy__isr_8h.html">vcos_legacy_isr.h</a>.</p>
<p>Registering an interrupt handler, and disabling/restoring interrupts, is handled using the functions in <a class="el" href="d6/dc3/vcos__isr_8h.html">vcos_isr.h</a>. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
